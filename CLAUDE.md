# CLAUDE.md - Flight

## Overview

This project uses **Flight** for prompt engineering quality.

- **Flight**: TDD-style methodology ensuring Claude generates correct code via domains, invariants, and constraints

## Build Commands

### Embedded C (P10-compliant)
```bash
# Compile with strict P10 warnings
gcc -Wall -Wextra -Werror -pedantic -std=c11 -o output src/*.c

# Run tests
cd src && ./test_ring_buffer

# Static analysis (if available)
cppcheck --enable=all --error-exitcode=1 src/
```

## Available Domains

| Domain | Purpose |
|--------|---------|
| `bash.md` | Shell script best practices, safe patterns |
| `code-hygiene.md` | **ALWAYS LOAD** - Universal naming, redundancy, quality (any language) |
| `embedded-c-p10.md` | NASA JPL Power of 10 safety-critical C rules |
| `javascript.md` | JavaScript/Node.js patterns |
| `nextjs.md` | Next.js App Router patterns |
| `python.md` | Python best practices and type safety |
| `react.md` | React component patterns |
| `react-line-formulas.md` | React component line count estimation |
| `rp2040-pico.md` | RP2040 Pico dual-core, spinlocks, ring buffers |
| `sms-twilio.md` | Twilio SMS integration |
| `sql.md` | SQL/PostgreSQL security and performance |
| `typescript.md` | TypeScript type safety patterns |

## Before ANY Code Generation

1. **ALWAYS load `code-hygiene.md`** - Universal quality rules for ALL code
2. **Load task-specific domains** - e.g., `react.md` for React, `python.md` for Python
3. **Check `@fix_plan.md`** - Current task priorities (if exists)
4. **Read `specs/`** - Technical specifications (if exists)
5. **Follow invariants** - If code follows the invariants, it's correct

## Flight Workflow

### Slash Commands

| Command | Purpose |
|---------|---------|
| `/flight-prime` | Research context, scan codebase, identify constraints |
| `/flight-compile` | Build atomic prompt from task + domains → outputs to PROMPT.md |
| `/flight-validate` | Check output against domain invariants |
| `/flight-tighten` | Analyze failures, strengthen domain rules |

### Key Principle

**Invariants over guidelines.** Domain files contain MUST/NEVER rules. Code that follows them is correct.

## Workflow

```
Prime → Compile → Execute → Validate
                              ↓
                    [PASS] → Done
                    [FAIL] → Tighten → Compile → ...
```

## Project Structure

```
project/
├── CLAUDE.md              # This file
├── PROMPT.md              # Generated by /flight-compile
├── README.md              # Flight methodology overview
├── .flight/
│   ├── FLIGHT.md          # Core methodology reference
│   ├── domains/           # Constraint files (*.md) - see Available Domains above
│   ├── templates/         # Prompt skeletons
│   ├── examples/          # Reference implementations
│   └── exercises/         # Training exercises
├── .claude/
│   └── commands/          # Slash command definitions
│       ├── flight-prime.md
│       ├── flight-compile.md
│       ├── flight-validate.md
│       ├── flight-tighten.md
│       └── flight-check.md
├── specs/                 # Technical specifications
└── src/                   # Source code (C files, headers, tests)
```

## Domain File Format

Domain files define invariants - rules that MUST be followed:

```markdown
# Domain: [Name]

## Invariants

### MUST
- [Required behavior]
- [Required pattern]

### NEVER
- [Forbidden pattern]
- [Anti-pattern to avoid]

## Patterns

[Example code patterns that satisfy invariants]

## Error Codes

[Domain-specific error handling]
```

## Quick Reference

```bash
# Start new feature
/flight-prime "Build [feature description]"
/flight-compile

# After code generation
/flight-validate

# If validation fails
/flight-tighten
# Then retry from /flight-compile
```
